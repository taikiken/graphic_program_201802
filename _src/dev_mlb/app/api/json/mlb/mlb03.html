<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>MLB JSON</title>
  <script src="../../assets/js/libs/vendor.react.js"></script>
  <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
  <style type="text/css">
    .json-format {
      border: 1px solid #ccc;
      padding: 8px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
<pre class="json-format" id="js-json-format"></pre>
<script type="text/babel">
  const ajax = (path) => {
    const request = new Request(
      path,
      {
        cache: 'no-cache',
        credentials: 'same-origin',
        method: 'GET',
      }
    );
    return fetch(request)
      .then((response) => {
        console.log('fetch', path, Date.now());
        if (response.status !== 200) {
          throw new Error(`ajax status error: (${response.status})`);
        }
        try {
          return response.json();
        } catch (error) {
          throw new Error(`ajax JSON parse error: (${error})`);
        }
      })
  };

  const element = document.getElementById('js-json-format');
  const replacer = (key, value) => {
//    return `${key}: ${value}, \n`;
    console.log('replacer', key, value);
    return `${value},\n`;
  };

  const output = (json) => {
//    element.innerHTML = JSON.stringify(json, 4, "\n");
    element.innerHTML = JSON.stringify(json, 0, "\n");
  };

  //  const keys = [
  //    'game_info',
  //    'team_info',
  //    'member_info',
  //  ];

  const parallel = (id) => {
    return [
      'game_info',
      'team_info',
      'member_info',
    ].map((key) => {
      return ajax(`json/games/${id}/${key}.json`);
    });
  };

  async function stats() {
    const schedule = await ajax('json/master/schedule/20170402.json');
//    const game = await ajax(`json/games/${schedule.schedule.regular_season.american.game_id}/game_info.json`);
//    const team = await ajax(`json/games/${schedule.schedule.regular_season.american.game_id}/team_info.json`);
//    const member = await ajax(`json/games/${schedule.schedule.regular_season.american.game_id}/member_info.json`);
//    output(member);
//    return {
//      schedule,
//      game,
//      team,
//      member,
//    };
    const american = await Promise.all(parallel(schedule.schedule.regular_season.american.game_id));
    const national = await Promise.all(parallel(schedule.schedule.regular_season.national.game_id));
    return {
      schedule,
      american,
      national,
    };
  }

  stats()
    .then((data) => {
      console.log('stats complete', data);
    })
    .catch((error) => {
      console.log('stats.catch', error);
    });



</script>
</body>
</html>